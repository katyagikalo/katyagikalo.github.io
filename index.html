<!DOCTYPE html>
<html>
<head>
    <title>Interactive Germany Map - katya</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map {
            height: 600px;
            width: 60%;
            margin-left: 0;
        }
        #info-box-container {
            position: absolute;
            top: 60px;
            right: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .info-box {
            width: 250px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .info-box strong {
            font-size: 16px;
            display: block;
            margin-bottom: 5px;
            text-align: center;
        }
        .info-box span {
            color: #555;
        }
        #slider-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 250px;
            background: #f9f9f9;
            border: 1px solid #ccc;
            padding: 15px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #slider-container label {
            display: block;
            margin-top: 10px;
        }
        #select-all-btn {
            margin-bottom: 10px;
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-family: Arial, sans-serif;
        }
        #select-all-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="info-box-container"></div>
    <div id="slider-container">
        <button id="select-all-btn">Select All</button>
        <label for="temperature-slider">Temperature:</label>
        <input type="range" id="temperature-slider" min="0" max="20" value="0" />
        <span id="temperature-value">+0<span>&#176;</span>C</span>

        <label for="humidity-slider">Humidity:</label>
        <input type="range" id="humidity-slider" min="0" max="100" value="50" />
        <span id="humidity-value">50%</span>

        <label for="wind-speed-slider">Wind Speed:</label>
        <input type="range" id="wind-speed-slider" min="0" max="50" value="10" />
        <span id="wind-speed-value">10 km/h</span>

        <label for="precipitation-slider">Precipitation:</label>
        <input type="range" id="precipitation-slider" min="0" max="200" value="0" />
        <span id="precipitation-value">0 mm</span>
    </div>

    <script>
        var map = L.map('map').setView([51.1657, 10.4515], 6);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CartoDB</a>'
        }).addTo(map);

        const highlightedDistricts = new Map(); // Store highlighted districts and their original colors
        const infoBoxContainer = document.getElementById('info-box-container');
        const selectAllBtn = document.getElementById('select-all-btn');

        const defaultStyle = {
            fillColor: 'silver',
            weight: 2,
            opacity: 1,
            color: 'white',
            fillOpacity: 0.7
        };

        const highlightedStyle = {
            fillColor: 'yellow',
            weight: 3,
            color: 'black',
            fillOpacity: 0.9
        };

        let geoJsonLayer; // Reference to the GeoJSON layer

        fetch('germany_new.geojson')
            .then(response => response.json())
            .then(data => {
                geoJsonLayer = L.geoJSON(data, {
                    style: defaultStyle,
                    onEachFeature: function (feature, layer) {
                        layer.on('click', function () {
                            toggleDistrictHighlight(layer, feature);
                        });
                    }
                }).addTo(map);

                // Crop everything outside Germany
                cropOutsideGermany(data);
            });

        function toggleDistrictHighlight(layer, feature) {
            const name = feature.properties.krs_name || "Unknown Region";
            const code = feature.properties.krs_code || "No Code Available";

            if (highlightedDistricts.has(layer)) {
                // Remove highlight and info
                layer.setStyle({
                    fillColor: highlightedDistricts.get(layer),
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    fillOpacity: 0.7
                });
                highlightedDistricts.delete(layer);
                removeDistrictInfo(name);
            } else {
                // Highlight and add info
                highlightedDistricts.set(layer, layer.options.fillColor || 'silver');
                layer.setStyle(highlightedStyle);
                addDistrictInfo(name, code);
            }
        }

        function addDistrictInfo(name, code) {
            const existingInfo = document.getElementById(`info-${name}`);
            if (!existingInfo) {
                const infoDiv = document.createElement('div');
                infoDiv.id = `info-${name}`;
                infoDiv.className = 'info-box';
                infoDiv.innerHTML = `
                    <strong>${name}</strong>
                    <span>KRS Code: ${code}</span>
                `;
                infoBoxContainer.appendChild(infoDiv);
            }
        }

        function removeDistrictInfo(name) {
            const infoDiv = document.getElementById(`info-${name}`);
            if (infoDiv) {
                infoBoxContainer.removeChild(infoDiv);
            }
        }

        // Crop functionality
        function cropOutsideGermany(geoJsonData) {
            const worldBounds = [[-90, -180], [90, 180]]; // Full world bounds
            const germanyMask = L.geoJSON(geoJsonData);

            const mask = L.polygon([
                [worldBounds[0][0], worldBounds[0][1]], // Bottom-left
                [worldBounds[0][0], worldBounds[1][1]], // Bottom-right
                [worldBounds[1][0], worldBounds[1][1]], // Top-right
                [worldBounds[1][0], worldBounds[0][1]], // Top-left
                [worldBounds[0][0], worldBounds[0][1]], // Back to Bottom-left
            ], {
                color: 'black',
                fillColor: 'black',
                fillOpacity: 0.8,
                interactive: false,
            }).addTo(map);

            map.fitBounds(germanyMask.getBounds()); // Zoom to Germany
            map.addLayer(mask);
            mask.bringToBack(); // Ensure mask is below the Germany layer
        }

        // Select All functionality
        selectAllBtn.addEventListener('click', function () {
            geoJsonLayer.eachLayer(function (layer) {
                const feature = layer.feature;
                if (!highlightedDistricts.has(layer)) {
                    toggleDistrictHighlight(layer, feature);
                }
            });
        });

        // Slider handling (unchanged from previous version)
        const sliders = {
            temperature: document.getElementById('temperature-slider'),
            humidity: document.getElementById('humidity-slider'),
            windSpeed: document.getElementById('wind-speed-slider'),
            precipitation: document.getElementById('precipitation-slider')
        };

        Object.keys(sliders).forEach(key => {
            sliders[key].addEventListener('input', function () {
                document.getElementById(`${key}-value`).textContent = key === 'temperature'
                    ? `+${this.value}${String.fromCharCode(176)}C`
                    : key === 'humidity'
                    ? `${this.value}%`
                    : key === 'windSpeed'
                    ? `${this.value} km/h`
                    : `${this.value} mm`;
            });
        });
    </script>
</body>
</html>
